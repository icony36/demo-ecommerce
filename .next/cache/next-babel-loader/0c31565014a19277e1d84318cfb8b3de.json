{"ast":null,"code":"import _parseFloat from \"@babel/runtime-corejs2/core-js/parse-float\";\nimport _parseInt from \"@babel/runtime-corejs2/core-js/parse-int\";\nimport _slicedToArray from \"@babel/runtime-corejs2/helpers/esm/slicedToArray\";\nimport React, { useState, useContext } from \"react\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport Container from \"@material-ui/core/Container\";\nimport Paper from \"@material-ui/core/Paper\";\nimport Stepper from \"@material-ui/core/Stepper\";\nimport Step from \"@material-ui/core/Step\";\nimport StepLabel from \"@material-ui/core/StepLabel\";\nimport Button from \"@material-ui/core/Button\";\nimport Typography from \"@material-ui/core/Typography\";\nimport CheckoutCart from \"../components/checkout/CheckoutCart\";\nimport Billing from \"../components/checkout/Billing\";\nimport Payment from \"../components/checkout/Payment\";\nimport Confirm from \"../components/checkout/Confirm\";\nimport CheckoutStyles from \"../styles/CheckoutStyles\";\nimport { ShopContext } from \"../contexts/ShopContext\";\nimport useInputState from \"../hooks/useInputState\";\nimport { formatCreditCardNumber, formatCVC, formatExpirationDate } from \"../components/checkout/CardFormat\";\nimport axios from \"axios\";\nvar useStyles = makeStyles(CheckoutStyles);\nvar initCheckout = {\n  country: \"\",\n  city: \"\",\n  zipcode: \"\",\n  address: \"\",\n  name: \"\",\n  companyName: \"\",\n  phone: \"\",\n  email: \"\",\n  cardType: \"\",\n  cardNum: \"\",\n  cardName: \"\",\n  cvc: \"\",\n  expiry: \"\"\n};\nvar steps = [\"Shopping Cart\", \"Billing & Shipping Method\", \"Payment Method\", \"Confirm Order\"];\n\nvar Checkout = function Checkout() {\n  var classes = useStyles();\n\n  var _useContext = useContext(ShopContext),\n      cart = _useContext.cart,\n      totalItems = _useContext.totalItems,\n      totalAmounts = _useContext.totalAmounts,\n      removeFromCart = _useContext.removeFromCart;\n\n  var _useState = useState(0),\n      _useState2 = _slicedToArray(_useState, 2),\n      activeStep = _useState2[0],\n      setActiveStep = _useState2[1];\n\n  var _useState3 = useState(cart.length > 0 ? cart.map(function (el) {\n    return el.id;\n  }) : []),\n      _useState4 = _slicedToArray(_useState3, 2),\n      selected = _useState4[0],\n      setSelected = _useState4[1];\n\n  var selectedItems = cart.filter(function (el) {\n    return selected.includes(el.id);\n  });\n\n  var _useInputState = useInputState(initCheckout),\n      _useInputState2 = _slicedToArray(_useInputState, 2),\n      checkoutInput = _useInputState2[0],\n      setCheckoutInput = _useInputState2[1]; // Stepper function\n\n\n  var handleNext = function handleNext() {\n    setActiveStep(function (prevActiveStep) {\n      return prevActiveStep + 1;\n    });\n  };\n\n  var handleBack = function handleBack() {\n    setActiveStep(function (prevActiveStep) {\n      return prevActiveStep - 1;\n    });\n  };\n\n  var handleReset = function handleReset() {\n    setActiveStep(0);\n  }; //CheckoutCart function\n\n\n  var handleSelectAllClick = function handleSelectAllClick(event) {\n    if (event.target.checked) {\n      setSelected(cart.map(function (el) {\n        return el.id;\n      }));\n      return;\n    }\n\n    setSelected([]);\n  };\n\n  var handleClick = function handleClick(event, id) {\n    var selectedIndex = selected.indexOf(id);\n    var newSelected = [];\n\n    if (selectedIndex === -1) {\n      newSelected = newSelected.concat(selected, id);\n    } else if (selectedIndex === 0) {\n      newSelected = newSelected.concat(selected.slice(1));\n    } else if (selectedIndex === selected.length - 1) {\n      newSelected = newSelected.concat(selected.slice(0, -1));\n    } else if (selectedIndex > 0) {\n      newSelected = newSelected.concat(selected.slice(0, selectedIndex), selected.slice(selectedIndex + 1));\n    }\n\n    setSelected(newSelected);\n    console.log(selected);\n  };\n\n  var removeFromSelected = function removeFromSelected(id) {\n    var index = selected.findIndex(function (el) {\n      return el == id;\n    });\n    selected.splice(index, 1);\n    setSelected(selected);\n  };\n\n  var handleRemove = function handleRemove(id) {\n    removeFromCart(id);\n    removeFromSelected(id);\n  };\n\n  var handleRemoveBundle = function handleRemoveBundle(idArr) {\n    idArr.forEach(function (el) {\n      removeFromCart(el);\n      removeFromSelected(el);\n    });\n  };\n\n  var sumSelectedAmounts = function sumSelectedAmounts() {\n    var total = 0;\n\n    for (var i = 0; i < selectedItems.length; i++) {\n      total += selectedItems[i].price * _parseInt(selectedItems[i].quantity);\n    }\n\n    return Number(Math.round(_parseFloat(total + \"e\" + 2)) + \"e-\" + 2);\n  }; // Payment function\n\n\n  var handleCardInput = function handleCardInput(evt) {\n    if (evt.target.name === \"cardNum\") {\n      evt.target.value = formatCreditCardNumber(evt.target.value);\n      setCheckoutInput(evt);\n    } else if (evt.target.name === \"expiry\") {\n      evt.target.value = formatExpirationDate(evt.target.value);\n      setCheckoutInput(evt);\n    } else if (evt.target.name === \"cvc\") {\n      evt.target.value = formatCVC(evt.target.value);\n      setCheckoutInput(evt);\n    }\n  }; // Place Order\n\n\n  var handleSubmit = function handleSubmit(evt) {\n    evt.preventDefault();\n    var country = checkoutInput.country,\n        city = checkoutInput.city,\n        zipcode = checkoutInput.zipcode,\n        address = checkoutInput.address,\n        name = checkoutInput.name,\n        companyName = checkoutInput.companyName,\n        phone = checkoutInput.phone,\n        email = checkoutInput.email,\n        cardNum = checkoutInput.cardNum;\n    var last4CardNum = cardNum.toString().substr(-4); // axios\n    //     .post(\"/checkout\", {\n    //         country,\n    //         city,\n    //         zipcode,\n    //         address,\n    //         name,\n    //         companyName,\n    //         phone,\n    //         email,\n    //         last4CardNum,\n    //         selectedItems\n    //     })\n    //     .then(res => {\n    //         console.log(\"Order is sent!: \" + res.status);\n    //     })\n    //     .catch(err => {\n    //         console.log(err, \"Can't submit order!\");\n    //     });\n\n    alert(\"\".concat(country, \",\\n            \").concat(city, \",\\n            \").concat(zipcode, \",\\n            \").concat(address, \",\\n            \").concat(name, \",\\n            \").concat(companyName, \",\\n            \").concat(phone, \",\\n            \").concat(email, \",\\n            \").concat(cardNum, \",\\n            \").concat(items));\n    handleNext();\n  };\n\n  var getStepContent = function getStepContent(step) {\n    switch (step) {\n      case 0:\n        return React.createElement(CheckoutCart, {\n          selected: selected,\n          handleSelectAllClick: handleSelectAllClick,\n          handleClick: handleClick,\n          handleRemove: handleRemove,\n          sumSelectedAmounts: sumSelectedAmounts\n        });\n\n      case 1:\n        return React.createElement(Billing, {\n          checkoutInput: checkoutInput,\n          setCheckoutInput: setCheckoutInput\n        });\n\n      case 2:\n        return React.createElement(Payment, {\n          checkoutInput: checkoutInput,\n          setCheckoutInput: setCheckoutInput,\n          handleCardInput: handleCardInput\n        });\n\n      case 3:\n        return React.createElement(Confirm, {\n          checkoutInput: checkoutInput,\n          selected: selected,\n          isPaid: false,\n          selectedItems: selectedItems,\n          handleReset: handleReset,\n          sumSelectedAmounts: sumSelectedAmounts\n        });\n\n      default:\n        return \"Unknown step\";\n    }\n  };\n\n  return React.createElement(React.Fragment, null, React.createElement(Container, null, React.createElement(Typography, {\n    className: classes.title,\n    variant: \"h5\"\n  }, \"Checkout\"), React.createElement(Stepper, {\n    activeStep: activeStep\n  }, steps.map(function (label, index) {\n    return React.createElement(Step, {\n      key: index\n    }, React.createElement(StepLabel, {\n      StepIconProps: {\n        classes: {\n          completed: classes.icon,\n          active: classes.icon\n        }\n      }\n    }, label));\n  })), React.createElement(Paper, {\n    elevation: 0,\n    className: classes.paper\n  }, activeStep === steps.length ? React.createElement(Confirm, {\n    checkoutInput: checkoutInput,\n    selected: selected,\n    isPaid: true,\n    handleReset: handleReset,\n    selectedItems: selectedItems,\n    sumSelectedAmounts: sumSelectedAmounts\n  }) : React.createElement(React.Fragment, null, getStepContent(activeStep), React.createElement(\"div\", null, activeStep === steps.length - 1 ? React.createElement(Button, {\n    variant: \"contained\",\n    color: \"secondary\",\n    className: classes.btnNext,\n    onClick: handleSubmit\n  }, \"Place Order\") : React.createElement(Button, {\n    variant: \"contained\",\n    color: \"secondary\",\n    onClick: handleNext,\n    className: classes.btnNext\n  }, \"Next\"), React.createElement(Button, {\n    disabled: activeStep === 0,\n    onClick: handleBack,\n    className: classes.btnBack\n  }, \"Back\"))))));\n};\n\nexport default Checkout;","map":{"version":3,"sources":["/Users/iantan/Desktop/Two-Halves-Sucre/source-code/pages/checkout.js"],"names":["React","useState","useContext","makeStyles","Container","Paper","Stepper","Step","StepLabel","Button","Typography","CheckoutCart","Billing","Payment","Confirm","CheckoutStyles","ShopContext","useInputState","formatCreditCardNumber","formatCVC","formatExpirationDate","axios","useStyles","initCheckout","country","city","zipcode","address","name","companyName","phone","email","cardType","cardNum","cardName","cvc","expiry","steps","Checkout","classes","cart","totalItems","totalAmounts","removeFromCart","activeStep","setActiveStep","length","map","el","id","selected","setSelected","selectedItems","filter","includes","checkoutInput","setCheckoutInput","handleNext","prevActiveStep","handleBack","handleReset","handleSelectAllClick","event","target","checked","handleClick","selectedIndex","indexOf","newSelected","concat","slice","console","log","removeFromSelected","index","findIndex","splice","handleRemove","handleRemoveBundle","idArr","forEach","sumSelectedAmounts","total","i","price","quantity","Number","Math","round","handleCardInput","evt","value","handleSubmit","preventDefault","last4CardNum","toString","substr","alert","items","getStepContent","step","title","label","completed","icon","active","paper","btnNext","btnBack"],"mappings":"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","sourcesContent":["import React, { useState, useContext } from \"react\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport Container from \"@material-ui/core/Container\";\nimport Paper from \"@material-ui/core/Paper\";\nimport Stepper from \"@material-ui/core/Stepper\";\nimport Step from \"@material-ui/core/Step\";\nimport StepLabel from \"@material-ui/core/StepLabel\";\nimport Button from \"@material-ui/core/Button\";\nimport Typography from \"@material-ui/core/Typography\";\nimport CheckoutCart from \"../components/checkout/CheckoutCart\";\nimport Billing from \"../components/checkout/Billing\";\nimport Payment from \"../components/checkout/Payment\";\nimport Confirm from \"../components/checkout/Confirm\";\nimport CheckoutStyles from \"../styles/CheckoutStyles\";\nimport { ShopContext } from \"../contexts/ShopContext\";\nimport useInputState from \"../hooks/useInputState\";\nimport {\n    formatCreditCardNumber,\n    formatCVC,\n    formatExpirationDate\n} from \"../components/checkout/CardFormat\";\nimport axios from \"axios\";\n\nconst useStyles = makeStyles(CheckoutStyles);\n\nconst initCheckout = {\n    country: \"\",\n    city: \"\",\n    zipcode: \"\",\n    address: \"\",\n    name: \"\",\n    companyName: \"\",\n    phone: \"\",\n    email: \"\",\n    cardType: \"\",\n    cardNum: \"\",\n    cardName: \"\",\n    cvc: \"\",\n    expiry: \"\"\n};\n\nconst steps = [\n    \"Shopping Cart\",\n    \"Billing & Shipping Method\",\n    \"Payment Method\",\n    \"Confirm Order\"\n];\n\nconst Checkout = () => {\n    const classes = useStyles();\n\n    const { cart, totalItems, totalAmounts, removeFromCart } = useContext(\n        ShopContext\n    );\n\n    const [activeStep, setActiveStep] = useState(0);\n    const [selected, setSelected] = useState(\n        cart.length > 0 ? cart.map(el => el.id) : []\n    );\n\n    const selectedItems = cart.filter(el => selected.includes(el.id));\n\n    const [checkoutInput, setCheckoutInput] = useInputState(initCheckout);\n\n    // Stepper function\n    const handleNext = () => {\n        setActiveStep(prevActiveStep => prevActiveStep + 1);\n    };\n\n    const handleBack = () => {\n        setActiveStep(prevActiveStep => prevActiveStep - 1);\n    };\n\n    const handleReset = () => {\n        setActiveStep(0);\n    };\n\n    //CheckoutCart function\n    const handleSelectAllClick = event => {\n        if (event.target.checked) {\n            setSelected(cart.map(el => el.id));\n            return;\n        }\n        setSelected([]);\n    };\n\n    const handleClick = (event, id) => {\n        const selectedIndex = selected.indexOf(id);\n\n        let newSelected = [];\n\n        if (selectedIndex === -1) {\n            newSelected = newSelected.concat(selected, id);\n        } else if (selectedIndex === 0) {\n            newSelected = newSelected.concat(selected.slice(1));\n        } else if (selectedIndex === selected.length - 1) {\n            newSelected = newSelected.concat(selected.slice(0, -1));\n        } else if (selectedIndex > 0) {\n            newSelected = newSelected.concat(\n                selected.slice(0, selectedIndex),\n                selected.slice(selectedIndex + 1)\n            );\n        }\n\n        setSelected(newSelected);\n        console.log(selected);\n    };\n\n    const removeFromSelected = id => {\n        let index = selected.findIndex(el => el == id);\n        selected.splice(index, 1);\n        setSelected(selected);\n    };\n\n    const handleRemove = id => {\n        removeFromCart(id);\n        removeFromSelected(id);\n    };\n\n    const handleRemoveBundle = idArr => {\n        idArr.forEach(el => {\n            removeFromCart(el);\n            removeFromSelected(el);\n        });\n    };\n\n    const sumSelectedAmounts = () => {\n        let total = 0;\n        for (var i = 0; i < selectedItems.length; i++) {\n            total +=\n                selectedItems[i].price * parseInt(selectedItems[i].quantity);\n        }\n\n        return Number(Math.round(parseFloat(total + \"e\" + 2)) + \"e-\" + 2);\n    };\n\n    // Payment function\n    const handleCardInput = evt => {\n        if (evt.target.name === \"cardNum\") {\n            evt.target.value = formatCreditCardNumber(evt.target.value);\n            setCheckoutInput(evt);\n        } else if (evt.target.name === \"expiry\") {\n            evt.target.value = formatExpirationDate(evt.target.value);\n            setCheckoutInput(evt);\n        } else if (evt.target.name === \"cvc\") {\n            evt.target.value = formatCVC(evt.target.value);\n            setCheckoutInput(evt);\n        }\n    };\n\n    // Place Order\n    const handleSubmit = evt => {\n        evt.preventDefault();\n\n        const {\n            country,\n            city,\n            zipcode,\n            address,\n            name,\n            companyName,\n            phone,\n            email,\n            cardNum\n        } = checkoutInput;\n\n        const last4CardNum = cardNum.toString().substr(-4);\n\n        // axios\n        //     .post(\"/checkout\", {\n        //         country,\n        //         city,\n        //         zipcode,\n        //         address,\n        //         name,\n        //         companyName,\n        //         phone,\n        //         email,\n        //         last4CardNum,\n        //         selectedItems\n        //     })\n        //     .then(res => {\n        //         console.log(\"Order is sent!: \" + res.status);\n        //     })\n        //     .catch(err => {\n        //         console.log(err, \"Can't submit order!\");\n        //     });\n        alert(\n            `${country},\n            ${city},\n            ${zipcode},\n            ${address},\n            ${name},\n            ${companyName},\n            ${phone},\n            ${email},\n            ${cardNum},\n            ${items}`\n        );\n        handleNext();\n    };\n\n    const getStepContent = step => {\n        switch (step) {\n            case 0:\n                return (\n                    <CheckoutCart\n                        selected={selected}\n                        handleSelectAllClick={handleSelectAllClick}\n                        handleClick={handleClick}\n                        handleRemove={handleRemove}\n                        sumSelectedAmounts={sumSelectedAmounts}\n                    />\n                );\n            case 1:\n                return (\n                    <Billing\n                        checkoutInput={checkoutInput}\n                        setCheckoutInput={setCheckoutInput}\n                    />\n                );\n            case 2:\n                return (\n                    <Payment\n                        checkoutInput={checkoutInput}\n                        setCheckoutInput={setCheckoutInput}\n                        handleCardInput={handleCardInput}\n                    />\n                );\n            case 3:\n                return (\n                    <Confirm\n                        checkoutInput={checkoutInput}\n                        selected={selected}\n                        isPaid={false}\n                        selectedItems={selectedItems}\n                        handleReset={handleReset}\n                        sumSelectedAmounts={sumSelectedAmounts}\n                    />\n                );\n            default:\n                return \"Unknown step\";\n        }\n    };\n\n    return (\n        <React.Fragment>\n            <Container>\n                <Typography className={classes.title} variant=\"h5\">\n                    Checkout\n                </Typography>\n                <Stepper activeStep={activeStep}>\n                    {steps.map((label, index) => (\n                        <Step key={index}>\n                            <StepLabel\n                                StepIconProps={{\n                                    classes: {\n                                        completed: classes.icon,\n                                        active: classes.icon\n                                    }\n                                }}\n                            >\n                                {label}\n                            </StepLabel>\n                        </Step>\n                    ))}\n                </Stepper>\n                <Paper elevation={0} className={classes.paper}>\n                    {activeStep === steps.length ? (\n                        <Confirm\n                            checkoutInput={checkoutInput}\n                            selected={selected}\n                            isPaid={true}\n                            handleReset={handleReset}\n                            selectedItems={selectedItems}\n                            sumSelectedAmounts={sumSelectedAmounts}\n                        />\n                    ) : (\n                        <React.Fragment>\n                            {getStepContent(activeStep)}\n                            <div>\n                                {activeStep === steps.length - 1 ? (\n                                    <Button\n                                        variant=\"contained\"\n                                        color=\"secondary\"\n                                        className={classes.btnNext}\n                                        onClick={handleSubmit}\n                                    >\n                                        Place Order\n                                    </Button>\n                                ) : (\n                                    <Button\n                                        variant=\"contained\"\n                                        color=\"secondary\"\n                                        onClick={handleNext}\n                                        className={classes.btnNext}\n                                    >\n                                        Next\n                                    </Button>\n                                )}\n\n                                <Button\n                                    disabled={activeStep === 0}\n                                    onClick={handleBack}\n                                    className={classes.btnBack}\n                                >\n                                    Back\n                                </Button>\n                            </div>\n                        </React.Fragment>\n                    )}\n                </Paper>\n            </Container>\n        </React.Fragment>\n    );\n};\n\nexport default Checkout;\n"]},"metadata":{},"sourceType":"module"}